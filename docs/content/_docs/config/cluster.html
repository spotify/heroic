---
title: Cluster Configuration
short_url: docs/config/cluster
---
<h2>{{ page.title }}</h2>

<p>
  Cluster configuration is located in the <code>cluster</code> section of the configuration.
</p>

<p>
  A typical configuration looks something like this.
</p>

<pre><code class="language-yaml">
cluster:
  tags:
    site: london
  protocols:
    - type: grpc
  discovery:
    type: static
    nodes:
      - "grpc://heroic-stockholm-a"
      - "grpc://heroic-stockholm-b"
      - "grpc://heroic-london-a"
      - "grpc://heroic-london-b"
</code></pre>

<h3 id="tags">
  <code>tags</code>
  <a class="link-to" href="{{ page.short_url }}#tags"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<pre><code class="language-yaml">
site: london
</code></pre>

<p>
  Defines a set of tags that identifies which part of the cluster this node belongs to.
  It's defined as an object like <code class="language-json">{"site": "london"}</code>.
  Nodes that have an identical set of tags are said to be part of the same <em>shard</em>.
  See the <a href="docs/federation">federation</a> section for more details.
</p>


<h3 id="topology">
  <code>topology</code>
  <a class="link-to" href="{{ page.short_url }}#topology"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<pre><code class="language-yaml">
topology:
  - site: london
</code></pre>

<p>
  Actual topology (shards) is detected based on the metadata coming from the nodes.
  Expected topology is specified in the optional 'topology'. This specifies the minimum
  shards expected, i.e. additional shards may also exist. If an expected shard is not responding the
  response will be include which shard was failing.

  See the <a href="docs/federation">federation</a> section for more details.
</p>


<h3>
  <code>protocols</code>
  <a class="link-to" href="{{ page.short_url }}#protocols"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>
  Contains a list of protocols that this node can speak.
</p>

<h4>grpc</h4>

<pre><code class="language-yaml">
host: &lt;host&gt;
port: &lt;port&gt;
maxFrameSize: &lt;maxFrameSize&gt;

</code></pre>

<table class="table">
  <tr>
    <td><code>host</code></td>
    <td>the address of the interface that this node will bind to.</td>
  </tr>
  <tr>
    <td><code>port</code></td>
    <td>the port number that this node will bind to.</td>
  </tr>
  <tr>
    <td><code>maxFrameSize</code></td>
    <td>frame size limit in bytes.</td>
  </tr>
</table>

<p>
    <a href="https://grpc.io">gRPC</a> is an open source RPC protocol.
</p>

<h3>
  <code>discovery</code>
  <a class="link-to" href="{{ page.short_url }}#discovery"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>
  The mechanism used to discover nodes in the cluster.
</p>

<h4>static</h4>
<pre><code class="language-yaml">
nodes:
  - &lt;url&gt;
  - ..
</code></pre>

<table class="table">
  <tr>
    <th>nodes</th>
    <td>
      Is the list of nodes that this node will attempt to add to its cluster registry.
      A valid url has the form <code>protocol://host[:port]</code>.
    </td>
  </tr>
</table>

<p>
  Static is the simplest possible form of discovery.

  It takes a list of nodes that may, or may not be reachable at the moment.

  This list will be queried at a given interval, and any that responds to a metadata request will be added to the local list of known members.
</p>

<h4>srv</h4>
<pre><code class="language-yaml">
records:
  - &lt;srv record&gt;
  - ..
</code></pre>

<table class="table">
  <tr>
    <th>records</th>
    <td>
      Is the list of srv records that this node will attempt to resolve and add  to its cluster registry.
    </td>
  </tr>

  <tr>
    <th>protocol</th>
    <td>
      Protocol to use when building the URI. Defaults to grpc.
    </td>
  </tr>

  <tr>
    <th>port</th>
    <td>
      Port to use when building the URI. Defaults to using the port specified in the SRV record unless the port is explicitly defined in the config.
    </td>
  </tr>
</table>

<p>
  Srv records are useful when running Heroic on more ephemeral environments like kubernetes.

  It takes a list srv records and resolves each one at a given interval, and any that responds to a metadata
  request will be added to the local list of known members.
</p>
